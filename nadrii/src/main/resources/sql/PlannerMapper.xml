<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PlannerMapper">

	<resultMap type="com.yagn.nadrii.service.domain.Planner" id="plannerSelectMap">
		<result property="postNo" column="post_no" jdbcType="NUMERIC"/>
		<result property="plannerMakerId" column="user_id" jdbcType="VARCHAR"/>
		<result property="title" column="title" jdbcType="VARCHAR"/>
		<result property="lat" column="lat" jdbcType="VARCHAR"/>
		<result property="lng" column="lng" jdbcType="VARCHAR"/>
		<result property="regDate" column="reg_date" jdbcType="DATE"/>
		<result property="viewCount" column="view_count" jdbcType="NUMERIC"/>
		<result property="flag" column="flag_pu" jdbcType="VARCHAR"/>
		<result property="photo" column="THUMBNAIL_IMAGE_FILE" jdbcType="DATE"/>
		<result property="text" column="text" jdbcType="CLOB"/>
	</resultMap>
	
	<insert id="addPlanner" parameterType="com.yagn.nadrii.service.domain.Planner">
		
		INSERT
		INTO POST( post_no,
			 	user_id,
			 	title,
			 	lat,
			 	lng,
			 	reg_date,
			 	view_count,
			 	flag_pu,
			 	THUMBNAIL_IMAGE_FILE,
			 	text)
		VALUES ( seq_post_post_no.nextval,
			 	#{plannerMakerId},
			 	#{title},
			 	#{lat},
			 	#{lng},
			 	SYSDATE,
			 	#{viewCount},
			 	#{flag},
			 	#{photo},
			 	#{text})
		
	</insert>
	
	<select  id="getTotalCount"  parameterType="com.yagn.nadrii.common.Search"	 resultType="int">
		SELECT COUNT(*)
	  	FROM(	SELECT post_no, user_id, title, text, thumbnail_image_file, reg_date, view_count, lat, lng, reg_date
	  									FROM post
										<where>
											<if test="searchCondition != null">
												<if test="searchCondition == 0 and searchKeyword !='' ">
						 							title LIKE '%${searchKeyword}%' AND
												</if>
												<if test="searchCondition == 1 and searchKeyword !='' ">
						 							text LIKE '%${searchKeyword}%' AND
												</if>
												<if test="searchCondition == 2 and searchKeyword !='' ">
						 							hashtag LIKE '%${searchKeyword}%' AND
												</if>
											</if>
											flag_pu='pl'
											AND user_id in 'test01'
											
										</where>
						) countTable						
	</select>
	
	<select id="listMyPlanner" parameterType="com.yagn.nadrii.common.Search" resultMap="plannerSelectMap">
		SELECT *
	  	FROM (	SELECT inner_table.* , ROWNUM AS row_seq
	  					FROM		(	SELECT post_no, user_id, title, text, thumbnail_image_file, reg_date, view_count, hashtag, lat, lng
	  									FROM post
										<where>
											<if test="searchCondition != null">
												<if test="searchCondition == 0 and searchKeyword !='' ">
						 							title LIKE '%${searchKeyword}%' AND
												</if>
												<if test="searchCondition == 1 and searchKeyword !='' ">
						 							text LIKE '%${searchKeyword}%' AND
												</if>
												<if test="searchCondition == 2 and searchKeyword !='' ">
						 							hashtag LIKE '%${searchKeyword}%' AND
												</if>
											</if>
											flag_pu='pl' AND user_id in 'test01'
											ORDER BY reg_date DESC
										</where>
										) inner_table
						WHERE ROWNUM &lt;= #{endRowNum} )
		WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum} 
	</select>
	
	
	<select id="listUserPlanner" parameterType="search" resultMap="plannerSelectMap">
		SELECT *
	  	FROM (	SELECT inner_table.* , ROWNUM AS row_seq
	  					FROM		(	SELECT post_no, user_id, title, text, thumbnail_image_file, reg_date, view_count, hashtag, lat, lng
	  									FROM post
										<where>
											<if test="searchCondition != null">
												<if test="searchCondition == 0 and searchKeyword !='' ">
						 							title LIKE '%${searchKeyword}%' AND
												</if>
												<if test="searchCondition == 1 and searchKeyword !='' ">
						 							text LIKE '%${searchKeyword}%' AND
												</if>
												<if test="searchCondition == 2 and searchKeyword !='' ">
						 							hashtag LIKE '%${searchKeyword}%' AND
												</if>
											</if>
											flag_pu='pl'
											ORDER BY reg_date DESC
										</where>
										) inner_table
						WHERE ROWNUM &lt;= #{endRowNum} )
		WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum}
	</select>
	
	
	<select id="getPlanner" parameterType="int" resultMap = "plannerSelectMap">
		SELECT * 
		FROM post
		where post_no in #{postNo}
	</select>
	
 	 
</mapper>